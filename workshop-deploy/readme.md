# Деплой приложения

После того, как приложение или страница готовы, их можно разместить в сети.

Чтобы любой пользователь мог обратиться к вашему сайту (серверу, на котором работает наша программа) у этого сервера должен быть постоянный и глобальный адрес. Доменное имя, (например example.com) это только указатель на IP-адрес сервера. Домашние и рабочие сети чаще всего не имеют постоянных адресов, из-за их дифицита. Даже если ваша сеть имеет статичный IP адрес, то ваш компьютер, подключенный к ней, находится за NAT (Network address translation) – это значит, что глобальный адрес всего один на всю сеть и он присваевается входной точке вашей сети (роутеру), и следовательно ваш компьютер имеет только локальный адрес (например 192.168.1.2). Поэтому компьютеры, подключенные к глобальной сети не могут напрямую подключится к вашему компьютеру или серверу установленному у вас дома.

Существует несколько способов как разместить программу в глобальной сети (получить глобальный/публичный IP-адрес):

1. Для того, чтобы код вашей программы выполнялся на вашем компьютере, но был доступен в интернете, можно использовать технологию, называемую __обратный туннель__. Это может быть специальный сервис или ваш собственный виртуальный сервер, работающий в качестве 'прокси'. Этот сервер, имеющий глобальный IP-адрес может отправлять запросы к вашему компьютеру, используя _обратный туннель_ – безопасное соединение с вашим компьютером, инициированное вашим компьютером. Пример сервиса: [ngrok.com](https://ngrok.com/download).
2. Для статичных страниц можно использовать __хостинг статичных файлов__ (static files hosting). Например: [github pages](https://pages.github.com/), список сервисов: [cheap or free static website hosting](http://alignedleft.com/resources/cheap-web-hosting).
3. Код выполняемый на сервере, код чат-бота или динамически формируемую страницу можно разместить используя __сервер__ (dedicated server) или __виртуальный сервер__ (VPS). В этом случае, вы чаще всего платите за аренду физической или виртуальной машины, на которой можете делать все что угодно: устанавливать программы которые вам нужны и выполнять любой код. Пример популярного сервиса для аренды VPS-серверов: [digitalocean](http://digitalocean.com).


### 1. Обратный туннель

Третий вариант, наименее распростанненный, но наиболее подходящий для художественных проектов с небольшим количеством пользователей. Чтобы воспользоваться сервисом необходимо:

1. Загрузить программу [ngrok](https://ngrok.com/download)
2. Разархивировать загруженный файл
3. Запустить программу из терминала указав путь к только что разархивированному файлу, например: `~/Downloads/ngrok http 8000` (данной командой мы запускаем туннель на 8000 порт)
4. В командной строке у вас должен отобразиться адрес домена, по которому теперь доступен ваш 8000 порт. Например:
    ```
    Forwarding  https://9c36621d.ngrok.io -> localhost:8000
    ```

Теперь любой подключившийся по этому адресу увидит вашу программу запущенную на этом порту. Полноценный пример приложения для тестирования обратного туннеля, который произносит введенную пользователем фразу: [example-say-input](../workshop-simple-interface/example-say-input).


### 2. Хостинг статичных файлов

Мы попробуем задеплоить сайт используя бесплатный сервис pages.github.com. Другие варианты деплоя могут сильно отличаться от этого, но менее практичны и требуют оплаты. Инструкция ниже позволяет создать сайт по адресу username.github.io. Возможно также привязать свой собственный домен к этому же сайту, также бесплатно.

1. Создать аккаунт на [github.com](https://github.com), это бесплатно
2. Скачать и установить [github desktop](https://desktop.github.com/)
3. Запустить программу, войти в нее под своим аккаунтом
4. Создать новый репозиторий в программе, название которого должно быть `username.github.io`, где `username` это имя пользователя, которое вы указали при регистрации
5. Поместить в папку репозитория все необходимые файлы сайта (например внутренности папки, которая получилась при экспорте из Unity). Таким образом, чтобы в корне репозитория, обязательно оказался файл `index.html`
6. Совершить `commit` – сохранить текущий статус файлов в папке репозитория, предварительно дав ему название
7. Синхронизировать изменения с github. Выбрать в меню __Repositoty > Push__ или нажать на кнопку синхронизации в интерфейсе
<!-- 8. Перейти на сайт github.com, найти там только что созданный репозиторий, перейти в его настройки, найти пункт __GitHub Pages__ и выбрать пункт __master branch__ в селекторе __Source__, нажать кнопку __Save__ -->


### 3. Виртуальный сервер

Для того, чтобы выполнять код программы в интернете, можно арендовать виртуальный ресурс в датацентре. Аренда виртуальная машины с одним процессором, 512Mb оперативной памяти и 20Gb жесткого диска стоит около $5 в месяц, и ее будет достаточно, чтобы выполнять код бота. Мы будем использовать сервис DigitalOcean, но почти весь процесс будет идентичен для других сервисов.

1. __Регистрация и покупка__. Этот пункт мы опускаем, потому что мы все можем использовать одну и ту же машину, которую я зарегистрирую для всех. В конце покупки вы получите адрес и пароль от машины, которую вы только что создали.
2. __Подключение по SSH__
    - Пользователи OS X должны открыть терминал. Пользователям Windows придется использовать программу, которая называется __putty__ или любой другой ssh-клиент
    - Пользователи OS X вводят в терминал команду `ssh root@server.ip.address.number`, где `server.ip.address.number` нужно заменить на адрес созданного сервера
    После выполнения этой команды вы оказываетесь в командной строке сервера, и можете выпонять те же команды, которые вы выполняли на своей машине (установка и выполнение программ), но теперь применительно к серверу.
4. __Загрузка / cинхронизация кода__
    - Для того чтобы поместить код вашей программы на сервер, на OS X можно использовать программу `rsync`. Команда должна выглядить следующим образом:
   ```
   rsync -av path/to/folder/from/ root@server.ip.address.number:/root/projects/
   ```
5. __Запуск__. Чтобы запустить программу, нужно выполнить те же команды, что мы выполняли на нашем компьютере: `cd` в папку проекта, `node app.js` и `npm install название-пакета` если какая-то из библиотек не установлена


### 4. Raspberry PI

В случае, если ваша программа не обязательно должна быть доступна в интернете по какому-то адресу (например не сайт, а чат-бот или просто бот), программу можно выполнять на машине, которая стоит например у вас дома. Для этого прекрасно подходят одноплатные компьютеры. Один из самых популярных – Raspberry PI – линукс-
